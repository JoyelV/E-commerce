<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>MOMENT Dashboard</title>
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="" />
  <meta property="og:type" content="" />
  <meta property="og:url" content="" />
  <meta property="og:image" content="" />
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/adminassets/imgs/theme/favicon.svg" />
  <!-- Template CSS -->
  <link href="/adminassets/css/main.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <div class="screen-overlay"></div>

  <aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top">
      <a href="index.html" class="brand-wrap">
        <img src="/adminassets/imgs/brands/7d02989082b082e58141cce8a7536ee3.jpg" class="logo" width="150px"
          height="auto" display="block" margin="0 auto" alt="Moment Dashboard" />
        <h4 style="color: black">Watch Store</h4>
      </a>
      <div>
        <button class="btn btn-icon btn-aside-minimize">
          <i class="text-muted material-icons md-menu_open"></i>
        </button>
      </div>
    </div>
    <nav>
      <ul class="menu-aside">
        <li class="menu-item">
          <a class="menu-link" href="/admin/dashboard">
            <i class="icon material-icons md-perm_identity"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/customers">
            <i class="icon material-icons md-person"></i>
            <span class="text">Users</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/categories">
            <i class="icon material-icons md-star"></i>
            <span class="text">Categories</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/products">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Products</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/orders">
            <i class="icon material-icons md-menu"></i>
            <span class="text">Orders</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/stocks">
            <i class="icon material-icons md-apps"></i>
            <span class="text">Inventory</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/coupons">
            <i class="icon material-icons md-apps"></i>
            <span class="text">Coupon</span>
          </a>
        </li>
        <li class="menu-item has-submenu active">
          <a class="menu-link" href="page-transactions-1.html">
            <i class="icon material-icons md-local_offer"></i>
            <span class="text">Offers</span>
          </a>
          <div class="submenu">
            <a href="/admin/category-offers">Category offer</a>
            <a href="/admin/product-offers">Product offer</a>
          </div>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/sales-reports">
            <i class="icon material-icons md-assessment"></i>
            <span class="text">Sales Report</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/logout">
            <i class="icon material-icons md-exit_to_app"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>
  <main class="main-wrap">
    <header class="main-header navbar">
      <div class="col-search"></div>
      <header class="header">
        <nav class="navbar navbar-expand-lg navbar-light bg-light"></nav>
      </header>

    </header>
    <section class="content-main">
      <div class="content-header">
        <div>
          <h2 class="content-title card-title">Product Offer</h2>
          <p>Add, edit Product offers</p>
        </div>
        <div>
          <a href="/admin/product-offers/create" class="btn btn-md rounded font-sm hover-up">Add new offer</a>
        </div>
      </div>
      <div class="card">
        <div class="card-body">
          <div class="col-md-13">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th class="col-md-1">No</th>
                    <th class="col-md-2 text-center">Offer Name</th>
                    <th class="col-md-2 text-center">Product Id</th>
                    <th class="col-md-1 text-center">Discount</th>
                    <th class="col-md-2 text-center">Starting Date</th>
                    <th class="col-md-1 text-center">Ending Date</th>
                    <th class="col-md-2 text-center">Edit</th>
                    <th class="col-md-1 text-center">Status</th>
                    <th class="col-md-2 text-center">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (locals.productOfferData ) { %>
                    <% for (let i=0; i < productOfferData.length; i++) { %>
                      <tr>
                        <td class="col-md-1 align-self-center align-items-center">
                          <%= i+1 %>
                        </td>

                        <td class="col-md-2 text-center">
                          <%= productOfferData[i].name %>
                        </td>
                        <td class="col-md-2 text-center">
                          <%= productOfferData[i].productOffer.product%>
                        </td>
                        <th class="col-md-1 text-center">
                          <%= productOfferData[i].productOffer.discount %> %
                        </th>
                        <th class="col-md-2 text-center">
                          <%= productOfferData[i].startingDate.toLocaleDateString('en-GB') %>
                        </th>
                        <th class="col-md-1 text-center">
                          <%= productOfferData[i].endingDate.toLocaleDateString('en-GB') %>
                        </th>
                        <td class="col-md-2 text-center">
                          <a href="/admin/product-offers/edit?id=<%= productOfferData[i]._id %>&prdId=<%= productOfferData[i].productOffer.product %>"
                            class="btn btn-sm font-sm btn-action btn-warning" style="width: 50%; color: white">Edit</a>
                        </td>
                        <th class="col-md-1 text-center">
                          <%= productOfferData[i].productOffer.offerStatus %>
                        </th>
                        <td>
                          <% if (productOfferData[i].productOffer.offerStatus) { %>
                            <button class="btn btn-danger"
                              onclick="toggleOffer('<%= productOfferData[i]._id %>', 'block')">
                              Deactivate
                            </button>
                            <% } else { %>
                              <button class="btn btn-success"
                                onclick="toggleOffer('<%= productOfferData[i]._id %>', 'unblock')">
                                Activate
                              </button>
                              <% } %>
                        </td>
                      </tr>
                      <% } %>
                        <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!-- Edit Product Offer Modal -->
    </section>
    <footer class="main-footer font-xs">
      <div class="row pb-30 pt-15">
        <div class="col-sm-6">
          <script>
            document.write(new Date().getFullYear());
          </script>
          Â©, Evara - HTML Ecommerce Template .
        </div>
        <div class="col-sm-6">
          <div class="text-sm-end">All rights reserved</div>
        </div>
      </div>
    </footer>
  </main>
  <script src="adminassets/js/vendors/jquery-3.6.0.min.js"></script>
  <script src="adminassets/js/vendors/bootstrap.bundle.min.js"></script>
  <script src="adminassets/js/vendors/select2.min.js"></script>
  <script src="adminassets/js/vendors/perfect-scrollbar.js"></script>
  <script src="adminassets/js/vendors/jquery.fullscreen.min.js"></script>
  <!-- Main Script -->
  <script src="adminassets/js/main.js" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
  <script>
    function toggleOffer(offerId, action) {
      fetch(`/admin/product-offers/${offerId}/${action}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          if (data.success) {
            location.reload();
          } else {
            alert(data.message || "Failed to update offer status.");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("Something went wrong. Please try again.");
        });
    }
  </script>
</body>

</html>